<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ø«Ø¨Øª Ø§ÛŒÙ…ÛŒÙ„</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 50px;
      background-color: #f0f0f0;
      direction: rtl;
    }
    input, button {
      font-size: 16px;
      padding: 10px;
      margin: 10px;
    }
    #result {
      margin-top: 20px;
      font-size: 18px;
      color: #333;
    }
  </style>
</head>
<body>
  <h2>Ø¢ÛŒØ§ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø³ÛŒØ³ØªÙ… ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ØŸ</h2>
  <input type="text" id="name" placeholder="Ù†Ø§Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
  <button onclick="checkUser()">Ø¨Ø±Ø±Ø³ÛŒ</button>
  <p id="result"></p>
  <div id="registerContainer"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwTDZZ2n2KyCL0NqNAG26euJcH4TYbsAlMk2dCAUQ5CEmPoCkMi2SWj06yNlYxnPN4e-A/exec";

    async function checkUser() {
      const nameInput = document.getElementById("name");
      const result = document.getElementById("result");
      const registerContainer = document.getElementById("registerContainer");
      const name = nameInput.value.trim();

      result.textContent = "";
      registerContainer.innerHTML = "";

      if (!name) {
        result.textContent = "â— Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.";
        return;
      }

      result.textContent = "ğŸ” Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...";

      try {
        const response = await fetch(`${API_URL}?name=${encodeURIComponent(name)}`);
        if (!response.ok) throw new Error(`Ú©Ø¯ Ù¾Ø§Ø³Ø®: ${response.status}`);
        const data = await response.json();

        if (data.error) {
          result.textContent = `âŒ Ø®Ø·Ø§: ${data.error}`;
        } else if (data.exists) {
          result.textContent = `âœ… Ú©Ø§Ø±Ø¨Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯. Ø§ÛŒÙ…ÛŒÙ„: ${data.email}`;
        } else {
          result.textContent = `âŒ Ú©Ø§Ø±Ø¨Ø± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯. Ø§ÛŒÙ…ÛŒÙ„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ: ${data.email}`;

          const registerButton = document.createElement("button");
          registerButton.textContent = "Ø«Ø¨Øª Ø§ÛŒÙ…ÛŒÙ„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ";
          registerButton.onclick = () => registerEmail(name, data.email);
          registerContainer.appendChild(registerButton);
        }
      } catch (err) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± GET:", err);
        result.textContent = `âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±: ${err.message}`;
      }
    }

    async function registerEmail(name, email) {
      const result = document.getElementById("result");
      const registerContainer = document.getElementById("registerContainer");

      result.textContent = "ğŸ“¨ Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øª...";

      try {
        const response = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ name, email })
        });

        if (!response.ok) throw new Error(`Ú©Ø¯ Ù¾Ø§Ø³Ø®: ${response.status}`);
        const data = await response.json();

        if (data.success) {
          result.textContent = `âœ… Ø§ÛŒÙ…ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯: ${email}`;
          registerContainer.innerHTML = "";
        } else {
          result.textContent = `âŒ Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª: ${data.error || "Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ"}`;
        }
      } catch (err) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± POST:", err);
        result.textContent = `âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª: ${err.message}`;
      }
    }
  </script>
</body>
</html>
